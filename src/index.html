<!DOCTYPE html>
<html lang="en">
<head>
  <!--Кодировка-->
  <meta charset="utf-8">
  <!--Титул сайта-->
  <title>New folder</title>
  <!--Иконка-->
  <link rel="icon" href="" type="image/x-icon">
  <!--Иконка для apple-->
  <link rel="apple-touch-icon" sizes="" href="">
  <!--То что выводиться в Google-->
  <meta name="description" content="">
  <!--Для поиска в Google-->
  <meta name="keywords" content="">
  <!--Для Facebook-->
  <meta property="og:url" content="">
  <meta property="og:title" content="">
  <meta property="og:description" content="">
  <meta property="og:type" content="">
  <meta property="og:image" content="">
  <!--Тема для адресной строки-->
  <meta name="theme-color" content="">
  <!--Альтернативные языки сайта-->
  <link rel="alternate" hreflang="" href="">
  <!--jQuery-->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!--Подключаем свои стили-->
  <link rel="stylesheet" href="style/style.min.css">
  <!--Подключаем свой js-->
  <script src="js/script.js"></script>
  <!--Viewport-->
  <meta name="viewport"
        content="width=device-width,
          user-scalable=no,
          initial-scale=1.0,
          maximum-scale=1.0,
          minimum-scale=1.0">
</head>
<body>
  @@include('components/_component.html')
  <!--lazy load-->
  <picture class="none">
    <source data-srcset="images/"  src="images/1x1.webp" media="(max-width:768px)">
    <source data-srcset="images/"  src="images/1x1.webp" media="(max-width:1024px)">
    <img data-src="images/" src="images/1x1.webp" >
  </picture>
  <script>
    const lazyImages = document.querySelectorAll('img[data-src],source[data-srcset]');
    const windowHeight = document.documentElement.clientHeight;

    let lazyImagesPositions = [];
    if(lazyImages.length > 0) {
      console.log(lazyImages)
      lazyImages.forEach(img => {
        if (img.dataset.src || img.dataset.srcset) {
          lazyImagesPositions.push(img.getBoundingClientRect().top + pageYOffset);
          lazyScrollCheck();
        }
      });
    }

    window.addEventListener('scroll',lazyScroll);

    function lazyScroll(){
      if(document.querySelectorAll('img[data-src],source[data-srcset]').length >0){
        lazyScrollCheck();
      }
    }

    console.log(lazyImagesPositions);

    function lazyScrollCheck(){
      let imgIndex = lazyImagesPositions.findIndex(
              item => pageYOffset > item - windowHeight
      );
      if(imgIndex >=0){
        if (lazyImages[imgIndex].dataset.src){
          lazyImages[imgIndex].src = lazyImages[imgIndex].dataset.src;
          lazyImages[imgIndex].removeAttribute('data-src');
        }else if (lazyImages[imgIndex].dataset.srcset){
          lazyImages[imgIndex].srcset = lazyImages[imgIndex].dataset.srcset;
          lazyImages[imgIndex].removeAttribute('data-srcset');
        }
        delete lazyImagesPositions[imgIndex];
      }
    }
  </script>
</body>
</html>